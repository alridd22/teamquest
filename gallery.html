<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover"/>
  <meta name="theme-color" content="#2A1F18">
  <title>TeamQuest ‚Äî Gallery</title>

  <style>
    :root{
      --bg:url("/TQ%20Web%20extended%20background-100.jpg");
      --ink:#2E2114; --ink-soft:#6A5A47;
      --parchment:#F7EED8; --parchment-2:#F3E6CF; --paper:#FFFDF8;
      --gold:#F0C433; --gold-deep:#A7711F;
      --nav-h:64px;
      --radius-card:22px; --radius-sm:14px;
      --shadow-card:0 18px 40px rgba(0,0,0,.35);
      --shadow-soft:0 6px 18px rgba(0,0,0,.12);
      --gutter:22px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--ink);
      background:
        linear-gradient(180deg, rgba(0,0,0,.24), rgba(0,0,0,.45)),
        var(--bg);
      background-size:cover;
      background-position:top center;
      background-attachment:fixed;
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
      padding-top:var(--nav-h);
    }

    /* NAV (consistent with activities) */
    .treasure-nav{
      position:fixed; top:0; left:0; right:0; z-index:1000; height:var(--nav-h);
      backdrop-filter:saturate(120%) blur(6px);
      background:linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.15));
      border-bottom:1px solid rgba(255,255,255,.18);
    }
    .nav-container{
      height:100%; padding:0 12px; display:flex; align-items:center; justify-content:space-between;
      max-width:1000px; margin:0 auto;
    }
    .nav-logo img{height:40px; width:auto; display:block; filter:drop-shadow(0 3px 10px rgba(0,0,0,.5))}
    .nav-toggle{background:none;border:none;color:#F7EED8;font-size:1.6rem;cursor:pointer}
    .nav-menu{
      position:fixed; top:var(--nav-h); left:-100%; width:100%; height:calc(100vh - var(--nav-h));
      background:linear-gradient(180deg, rgba(0,0,0,.85), rgba(0,0,0,.72));
      display:flex; flex-direction:column; align-items:center; gap:14px; padding:18px 14px; transition:left .25s;
    }
    .nav-menu.active{left:0}
    .nav-link,.dropdown-link{
      display:block; width:92%; max-width:360px; text-align:center;
      text-decoration:none; color:#F7EED8; font-weight:900;
      padding:12px 14px; border-radius:14px;
      background:rgba(247,238,216,.22); border:1px solid rgba(255,255,255,.3);
    }
    .nav-link:hover,.dropdown-link:hover{ background:rgba(247,238,216,.32) }

    /* HERO with logo */
    .hero{
      min-height:220px;
      display:flex; flex-direction:column; align-items:center; justify-content:flex-end;
      padding:24px var(--gutter) 18px; text-align:center;
    }
    .brand-logo{
      width:min(220px,68vw); height:auto; margin-bottom:8px;
      filter: drop-shadow(0 2px 0 rgba(0,0,0,.25)) drop-shadow(0 10px 24px rgba(0,0,0,.35));
    }
    .hero-title{
      font-weight:900; font-size:22px; color:#F7EED8; letter-spacing:.2px;
      text-shadow:0 2px 6px rgba(0,0,0,.6);
    }

    /* STACK + PANEL */
    .stack{ padding:0 var(--gutter) 28px; }
    .panel{
      background:var(--parchment);
      border-radius:var(--radius-card);
      box-shadow:var(--shadow-card);
      padding:18px 16px;
      border:1px solid rgba(0,0,0,.06);
      margin:0 auto; width:100%; max-width:1100px;
    }
    h1{margin:0 0 6px; color:var(--ink); font-weight:900}
    .sub{color:var(--ink-soft); margin-bottom:12px; font-weight:700}

    /* Tabs */
    .tabs{display:flex;gap:10px;margin:8px 0 14px; flex-wrap:wrap}
    .tab{
      padding:10px 14px; border-radius:999px; border:2px solid var(--gold-deep);
      background:linear-gradient(90deg, #FDBA2D, #F0C433); cursor:pointer; font-weight:900; color:#442812;
      box-shadow:0 6px 14px rgba(0,0,0,.12);
    }
    .tab.active{filter:brightness(1.05)}
    .tab.ghost{
      background:var(--parchment-2); color:var(--ink); border-color:#C6A168;
    }

    /* Grid + cards */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    @media (max-width: 900px){.grid{grid-template-columns:1fr 1fr}}
    @media (max-width: 600px){.grid{grid-template-columns:1fr}}

    .card{
      background:var(--paper);
      border:1px solid #ecdac7;
      border-radius:16px;
      padding:12px;
      box-shadow:var(--shadow-soft);
    }
    .card img{width:100%;height:200px;object-fit:cover;border-radius:12px;margin-bottom:8px;border:2px solid #e7d8c4}
    .meta{display:flex;justify-content:space-between;align-items:center;gap:10px;margin:6px 0 8px}
    .team{font-weight:900;color:#4a351e}
    .tag{font-weight:900;font-size:12px;border:2px dashed #C6A168;border-radius:999px;padding:4px 10px;background:#fff0d1}
    .text{margin:6px 0 0; color:#4a3a26; line-height:1.5}

    .lock{
      background:#fff7e6;border:2px dashed #d69b45;border-radius:16px;padding:18px;text-align:center;
      font-weight:800;color:#6A5A47
    }
    .status{margin-top:12px;text-align:center;color:#6A5A47;font-weight:700}
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="treasure-nav" id="treasure-nav">
    <div class="nav-container">
      <a href="https://theteamquest.netlify.app/" class="nav-logo" aria-label="TeamQuest Home">
        <img src="/Team%20Quest%20Logo-01.png" alt="TeamQuest Logo">
      </a>
      <button class="nav-toggle" id="nav-toggle" aria-label="Toggle menu">‚ò∞</button>
    </div>
    <ul class="nav-menu" id="nav-menu" role="menu">
      <li><a href="https://theteamquest.netlify.app/clue_hunt" class="nav-link" role="menuitem">üíé The Treasure Hunt</a></li>
      <li><a href="https://theteamquest.netlify.app/scavenger" class="nav-link" role="menuitem">üîç The Scavenger Hunt</a></li>
      <li><a href="https://theteamquest.netlify.app/quiz" class="nav-link" role="menuitem">‚è∞ The Timed Quiz</a></li>
      <li><a href="https://theteamquest.netlify.app/limerick" class="nav-link" role="menuitem">üìù The Limerick Challenge</a></li>
      <li><a href="https://theteamquest.netlify.app/kindness" class="nav-link" role="menuitem">üíñ Kindness</a></li>
      <!-- Gallery intentionally omitted on this page -->
      <li><a href="https://theteamquest.netlify.app/leaderboard" class="dropdown-link" role="menuitem">üèÜ The Leaderboard</a></li>
    </ul>
  </nav>

  <!-- HERO -->
  <header class="hero">
    <img src="/Team%20Quest%20Logo-01.png" alt="TeamQuest" class="brand-logo" width="640" height="480">
    <div class="hero-title">Gallery</div>
  </header>

  <!-- CONTENT -->
  <main class="stack">
    <section class="panel">
      <h1>üèÖ Gallery</h1>
      <div class="sub">Limericks and Acts of Kindness from the adventure</div>

      <div id="lock" class="lock" style="display:none">üîí The gallery will unlock when results are published. Check back soon!</div>

      <div id="content" style="display:none">
        <div class="tabs">
          <button class="tab active" data-view="both">All</button>
          <button class="tab ghost" data-view="limerick">Limericks</button>
          <button class="tab ghost" data-view="kindness">Kindness</button>
        </div>

        <div id="grid" class="grid"></div>
        <div class="status" id="status">Loaded</div>
      </div>
    </section>
  </main>

  <script>
    // Mobile nav toggle (same behaviour as activities)
    (function(){
      const navToggle = document.getElementById('nav-toggle');
      const navMenu   = document.getElementById('nav-menu');
      if(navToggle && navMenu){
        navToggle.addEventListener('click', ()=> {
          navMenu.classList.toggle('active');
          navToggle.textContent = navMenu.classList.contains('active') ? '‚úï' : '‚ò∞';
        });
        document.addEventListener('click', (e)=> {
          const inside = navToggle.contains(e.target) || navMenu.contains(e.target);
          if(!inside && navMenu.classList.contains('active')){ navMenu.classList.remove('active'); navToggle.textContent='‚ò∞'; }
        });
      }
    })();

    // Gallery logic (unchanged contract)
    const qs = new URLSearchParams(location.search);
    const EVENT_ID = qs.get('event') || qs.get('eventId') || '';

    const $ = s => document.querySelector(s);
    let data = {limerick:[], kindness:[], published:false};

    function esc(s){ return String(s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
    function nl2br(s){ return esc(s).replace(/\n/g,'<br>'); }

    function cardHtml(e){
      const img = e.imageUrl ? `<img src="${esc(e.imageUrl)}" alt="evidence">` : '';
      const text = e.text ? `<div class="text">${nl2br(e.text)}</div>` : '';
      const tag = `<span class="tag">${e.activity ? esc(e.activity) : 'submission'}</span>`;
      return `
        <div class="card">
          ${img}
          <div class="meta">
            <div class="team">${esc(e.teamName || 'Unknown Crew')}</div>
            ${tag}
          </div>
          ${text}
        </div>
      `;
    }

    function render(view='both'){
      const items = [
        ...(view==='kindness' ? [] : data.limerick.map(x => ({...x, activity:'limerick'}))),
        ...(view==='limerick' ? [] : data.kindness.map(x => ({...x, activity:'kindness'}))),
      ];
      $('#grid').innerHTML = items.length ? items.map(cardHtml).join('') :
        `<div class="lock">No submissions yet.</div>`;
      $('#status').textContent = `Showing ${items.length} item(s)`;
    }

    function setTabs(){
      document.querySelectorAll('.tab').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
          document.querySelectorAll('.tab').forEach(b=>b.classList.add('ghost'));
          btn.classList.add('active');
          btn.classList.remove('ghost');
          render(btn.dataset.view);
        });
      });
    }

    async function load(){
      const base = '/.netlify/functions/get_gallery';
      const url = EVENT_ID ? `${base}?eventId=${encodeURIComponent(EVENT_ID)}` : base;
      const r = await fetch(url);
      const j = await r.json().catch(()=>({ success:false, message:'Bad JSON' }));
      if (!r.ok || j.success === false) throw new Error(j.message || 'Failed to load gallery');

      if (!j.published){
        $('#lock').style.display = 'block';
        $('#content').style.display = 'none';
        return;
      }

      data = {
        limerick: Array.isArray(j.limerick) ? j.limerick : [],
        kindness: Array.isArray(j.kindness) ? j.kindness : [],
        published: true,
      };

      $('#lock').style.display = 'none';
      $('#content').style.display = 'block';
      setTabs();
      render('both');
    }

    load().catch(err=>{
      $('#lock').style.display = 'block';
      $('#lock').textContent = '‚ö†Ô∏è ' + (err.message || 'Unable to load gallery');
    });
  </script>
</body>
</html>
