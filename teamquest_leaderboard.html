async function loadLeaderboard() {
            const loadingElement = document.getElementById('loading');
            const errorElement = document.getElementById('error');
            const contentElement = document.getElementById('leaderboard-content');

            try {
                loadingElement.style.display = 'block';
                errorElement.style.display = 'none';
                contentElement.style.display = 'none';

                console.log('Loading leaderboard data...');
                
                // Fetch data from our secure Netlify function
                const response = await fetch('/.netlify/functions/get_leaderboard_function');
                
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('HTTP error response:', errorText);
                    throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);
                }
                
                const responseText = await response.text();
                console.log('Raw response text:', responseText.substring(0, 500) + '...');
                
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('JSON parse error:', parseError);
                    console.error('Response that failed to parse:', responseText);
                    throw new Error(`Failed to parse JSON response: ${parseError.message}`);
                }
                
                console.log('Parsed result:', result);
                
                if (!result.success) {
                    throw new Error(result.error || 'Unknown error from server');
                }
                
                if (!result.teams || !Array.isArray(result.teams)) {
                    throw new Error('Invalid response format: missing teams array');
                }
                
                console.log('Loaded', result.teams.length, 'teams');
                renderLeaderboard(result.teams);
                
                loadingElement.style.display = 'none';
                contentElement.style.display = 'block';
                
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();

            } catch (error) {
                console.error('Error loading leaderboard:', error);
                loadingElement.style.display = 'none';
                errorElement.style.display = 'block';
                errorElement.innerHTML = `
                    Failed to load leaderboard data: ${error.message}
                    <br><button onclick="loadLeaderboard()" style="margin-top: 10px; padding: 5px 10px;">Retry</button>
                `;
            }
        }
