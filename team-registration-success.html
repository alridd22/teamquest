<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Crew Registered - Terry's Treasure Quest</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background:linear-gradient(135deg,#8B4513 0%,#D2691E 30%,#F4A460 100%);
      min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;position:relative
    }
    body::before{
      content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
      background:
        radial-gradient(circle at 20% 20%, rgba(255,215,0,.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(255,140,0,.1) 0%, transparent 50%),
        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="1" fill="rgba(255,215,0,0.3)"/><circle cx="80" cy="40" r="0.5" fill="rgba(255,140,0,0.2)"/><circle cx="40" cy="80" r="1.5" fill="rgba(218,165,32,0.2)"/></svg>')
    }
    .container{
      background:linear-gradient(145deg,#F5E6D3 0%, rgba(245,230,211,.95) 100%);
      backdrop-filter:blur(10px);border-radius:25px;padding:40px;max-width:700px;width:100%;
      text-align:center;animation:slideUp .6s ease-out;border:3px solid #8B4513;position:relative;z-index:1;
      box-shadow:0 20px 40px rgba(0,0,0,.2), inset 0 1px 0 rgba(255,255,255,.3)
    }
    .container::before{content:'';position:absolute;top:0;left:0;right:0;height:8px;background:linear-gradient(90deg,#FFD700,#FF8C00,#DAA520,#FFD700)}
    .container::after{content:'';position:absolute;top:15px;left:15px;right:15px;bottom:15px;border:2px solid #DAA520;border-radius:20px;pointer-events:none}
    @keyframes slideUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
    .success-icon{font-size:4rem;margin-bottom:20px;animation:bounce 1.5s ease-in-out;filter:drop-shadow(2px 2px 4px rgba(139,69,19,.3))}
    @keyframes bounce{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
    .title{color:#8B4513;font-size:2.2rem;font-weight:700;margin-bottom:10px;text-shadow:2px 2px 4px rgba(0,0,0,.1)}
    .crew-name{
      background:linear-gradient(135deg,#FFD700,#FF8C00);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
      font-size:1.75rem;font-weight:bold;margin:8px 0 18px;border:3px solid #DAA520;border-radius:15px;padding:10px 14px;display:inline-block;
      box-shadow:0 4px 12px rgba(139,69,19,.2)
    }
    .subtitle{color:#654321;font-size:1.05rem;margin-bottom:22px;font-weight:500}
    .terry-greeting{display:flex;align-items:flex-start;gap:20px;margin:18px 0;background:linear-gradient(135deg,#FFF8DC 0%,#F5E6D3 100%);
      border-radius:20px;padding:20px;border:3px solid #DAA520;box-shadow:0 5px 15px rgba(139,69,19,.2);text-align:left}
    .terry-character{flex-shrink:0}
    .terry-character img{width:100px!important;height:100px!important;border-radius:15px!important;border:4px solid #DAA520;
      box-shadow:0 4px 12px rgba(139,69,19,.3);object-fit:cover;background:linear-gradient(135deg,#8B4513,#A0522D);display:block}
    .terry-speech{flex:1;position:relative}
    .terry-speech::before{content:'';position:absolute;left:-15px;top:20px;width:0;height:0;border-style:solid;border-width:15px 15px 15px 0;border-color:transparent #FFD700 transparent transparent}
    .terry-note{background:linear-gradient(135deg,#FFD700 0%,#FFA500 100%);color:#8B4513;padding:16px;border-radius:12px;margin:0;border:3px solid #DAA520;font-weight:500;line-height:1.5;box-shadow:0 5px 15px rgba(255,215,0,.3)}
    .adventure-status{background:linear-gradient(135deg,#FF8C00,#DAA520);color:#fff;padding:18px;border-radius:18px;margin:18px 0 26px;border:3px solid #8B4513;box-shadow:0 8px 20px rgba(255,140,0,.3)}
    .adventure-status h3{margin-bottom:6px;font-size:1.15rem;font-weight:700;text-shadow:1px 1px 2px rgba(0,0,0,.2)}
    .adventure-status p{opacity:.95;line-height:1.5;font-weight:500}
    .info-section{background:linear-gradient(135deg,#FFF8DC 0%,#F5E6D3 100%);border-radius:20px;padding:22px;margin-bottom:18px;text-align:left;border:3px solid #DAA520;box-shadow:0 4px 12px rgba(139,69,19,.1)}
    .info-section h3{color:#8B4513;font-size:1.15rem;margin-bottom:12px;display:flex;align-items:center;gap:10px;font-weight:700}
    .info-section ul{list-style:none;padding-left:0}
    .info-section li{color:#654321;padding:8px 0;display:flex;align-items:center;gap:12px;font-weight:500}
    .info-section li::before{content:"‚öîÔ∏è";font-size:1.1rem}
    .action-buttons{display:flex;gap:16px;justify-content:center;flex-wrap:wrap}
    .btn{padding:14px 26px;border:none;border-radius:15px;font-size:1.05rem;font-weight:700;cursor:pointer;transition:all .3s ease;text-decoration:none;display:inline-flex;align-items:center;gap:10px;text-shadow:1px 1px 2px rgba(0,0,0,.2)}
    .btn-primary{background:linear-gradient(135deg,#FF8C00,#DAA520);color:#fff;border:3px solid #8B4513}
    .btn-primary:hover{transform:translateY(-2px);box-shadow:0 12px 25px rgba(255,140,0,.3);background:linear-gradient(135deg,#FFB347,#F0C814)}
    .btn-secondary{background:linear-gradient(145deg,#FFF8DC 0%,#F5E6D3 100%);color:#8B4513;border:3px solid #DAA520}
    .btn-secondary:hover{background:linear-gradient(135deg,#FFD700,#FFA500);color:#fff;transform:translateY(-2px);box-shadow:0 8px 20px rgba(218,165,32,.3)}
    @media (max-width:600px){
      .container{padding:30px 20px}
      .title{font-size:2rem}
      .crew-name{font-size:1.4rem}
      .action-buttons{flex-direction:column}
      .btn{width:100%;justify-content:center}
      .terry-greeting{flex-direction:column;align-items:center;text-align:center}
      .terry-speech::before{display:none}
      .terry-character img{width:90px!important;height:90px!important}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="success-icon">üè¥‚Äç‚ò†Ô∏è</div>
    <h1 class="title">Crew Registered</h1>

    <div class="crew-name" id="crew-name-display">Loading‚Ä¶</div>
    <p class="subtitle">You‚Äôre in. Keep this page open ‚Äî we‚Äôll tell you when the quest begins.</p>

    <div class="terry-greeting">
      <div class="terry-character">
        <img src="/terry-thinking.png" alt="Terry Quest" class="terry-image">
      </div>
      <div class="terry-speech">
        <div class="terry-note">
          <strong>Nice work!</strong> When the horn sounds, you‚Äôll have limited time to complete challenges and earn points. Return before time‚Äôs up.
        </div>
      </div>
    </div>

    <div class="adventure-status" id="statusCard">
      <h3>‚è∞ Adventure Status</h3>
      <p id="statusText">Checking status‚Ä¶</p>
    </div>

    <div class="info-section">
      <h3>üó∫Ô∏è What‚Äôs next</h3>
      <ul>
        <li>Wait for the organiser to start the event.</li>
        <li>Open the challenges hub when we‚Äôre live.</li>
        <li>Watch your score on the leaderboard.</li>
      </ul>
    </div>

    <div class="action-buttons">
      <a href="/leaderboard" class="btn btn-secondary">üèÜ Live Leaderboard</a>
      <a href="/index.html" class="btn btn-primary" id="hubBtn">üöÄ Go to Challenges</a>
    </div>
  </div>

  <script>
    // Crew name from URL or localStorage
    const qs = new URLSearchParams(location.search);
    const teamFromQS  = qs.get('team');
    const codeFromQS  = qs.get('code');
    const teamNameLS  = localStorage.getItem('tq_team_name');
    const crewEl = document.getElementById('crew-name-display');
    crewEl.textContent = teamFromQS || teamNameLS || (codeFromQS ? `Crew ${codeFromQS.toUpperCase()}` : 'Your Crew');

    // Subtle confetti (lighter than before)
    function confetti() {
      const colors = ['#FFD700','#DAA520','#FF8C00','#8B4513','#DEB887'];
      for (let i=0;i<30;i++){
        setTimeout(()=> {
          const c = document.createElement('div');
          c.style.cssText = `
            position: fixed; width: 10px; height: 10px; top: -10px; left: ${Math.random()*100}vw;
            background: ${colors[Math.floor(Math.random()*colors.length)]}; border-radius: 50%;
            pointer-events:none; animation: fall 2.6s linear forwards; z-index:1000; box-shadow:0 2px 4px rgba(0,0,0,.2);
          `;
          document.body.appendChild(c);
          setTimeout(()=>c.remove(), 2600);
        }, i*70);
      }
    }
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fall { 0%{transform:translateY(-100vh) rotate(0);opacity:1} 100%{transform:translateY(100vh) rotate(360deg);opacity:0} }
    `;
    document.head.appendChild(style);
    setTimeout(confetti, 300);

    // Live status
    async function refreshStatus(){
      try{
        const r = await fetch('/.netlify/functions/get_event_state');
        const j = await r.json();
        const text = document.getElementById('statusText');
        const card = document.getElementById('statusCard');

        if (!j.success) throw new Error(j.message || 'Status error');

        if (j.state === 'RUNNING') {
          text.textContent = 'We‚Äôre live! Jump into the challenges.';
          card.style.background = 'linear-gradient(135deg,#2e7d32,#43a047)'; // green-ish
        } else if (j.state === 'PUBLISHED') {
          text.textContent = 'Event finished. You can still view the leaderboard.';
          card.style.background = 'linear-gradient(135deg,#6d4c41,#8d6e63)';
        } else {
          text.textContent = 'Waiting for start.';
          card.style.background = 'linear-gradient(135deg,#FF8C00,#DAA520)';
        }
      } catch(e){
        document.getElementById('statusText').textContent = 'Status unavailable right now.';
      }
    }
    refreshStatus();
    // Poll occasionally so the page updates when the organiser starts the event
    setInterval(refreshStatus, 15000);
  </script>
</body>
</html>
